<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>NGS Survey Control REST API | rlafranchi</title>
    <meta name="description" content="I&#39;ve been working for a Land Surveying company as both a field chief and a project manager for almost a decade now.  After deciding to pursue a career in web development, I&#39;ve been trying to think of ...">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="alternate" type="application/rss+xml" href="https://rlafranchi.github.io/rss.xml" title="rlafranchi RSS Feed">
    
    <link rel="preload" href="/assets/css/0.styles.e75e83ed.css" as="style"><link rel="preload" href="/assets/js/app.79e45c90.js" as="script"><link rel="preload" href="/assets/js/6.b90c3e6b.js" as="script"><link rel="preload" href="/assets/js/4.36743f4f.js" as="script"><link rel="preload" href="/assets/js/17.05c4363e.js" as="script"><link rel="prefetch" href="/assets/js/1.e4fcd2d8.js"><link rel="prefetch" href="/assets/js/10.f9c1e48b.js"><link rel="prefetch" href="/assets/js/11.f5d105a6.js"><link rel="prefetch" href="/assets/js/12.3456f31c.js"><link rel="prefetch" href="/assets/js/13.7793bb49.js"><link rel="prefetch" href="/assets/js/14.f061e069.js"><link rel="prefetch" href="/assets/js/15.e53f4080.js"><link rel="prefetch" href="/assets/js/16.b3ff4261.js"><link rel="prefetch" href="/assets/js/18.1f07dcf3.js"><link rel="prefetch" href="/assets/js/19.73d8c73e.js"><link rel="prefetch" href="/assets/js/20.38cd0045.js"><link rel="prefetch" href="/assets/js/21.7a3d18f9.js"><link rel="prefetch" href="/assets/js/22.06e11986.js"><link rel="prefetch" href="/assets/js/23.5d5ad258.js"><link rel="prefetch" href="/assets/js/24.e94fa854.js"><link rel="prefetch" href="/assets/js/25.95b10bc1.js"><link rel="prefetch" href="/assets/js/26.cd245f39.js"><link rel="prefetch" href="/assets/js/27.1f694f9c.js"><link rel="prefetch" href="/assets/js/28.c6c51b5d.js"><link rel="prefetch" href="/assets/js/29.5364fb9a.js"><link rel="prefetch" href="/assets/js/30.f8f323ec.js"><link rel="prefetch" href="/assets/js/31.05890330.js"><link rel="prefetch" href="/assets/js/32.1c26d5c6.js"><link rel="prefetch" href="/assets/js/33.12f56799.js"><link rel="prefetch" href="/assets/js/34.aaf38614.js"><link rel="prefetch" href="/assets/js/5.516375af.js"><link rel="prefetch" href="/assets/js/7.a7a640b8.js"><link rel="prefetch" href="/assets/js/8.8759eba1.js"><link rel="prefetch" href="/assets/js/9.a4e8e5d1.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.67eead48.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e75e83ed.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">rlafranchi </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">About</a></li><li class="nav-item"><a href="/posts/" class="nav-link">Blog</a></li><li class="nav-item"><a href="/tag/" class="nav-link">Tags</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <a href="/rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">rlafranchi </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">About</a></li><li class="mobile-nav-item"><a href="/posts/" class="nav-link">Blog</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">Tags</a></li> <li class="mobile-nav-item"><a href="/rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        NGS Survey Control REST API
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">Richard LaFranchi</span> <!----></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2015-03-26T00:00:00.000Z">
      Wed Mar 25 2015
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-d832e844><a href="/tag/National Geodetic Survey" data-v-d832e844> National Geodetic Survey </a></li><li class="post-tag" data-v-d832e844><a href="/tag/Land Surveying" data-v-d832e844> Land Surveying </a></li><li class="post-tag" data-v-d832e844><a href="/tag/Ruby" data-v-d832e844> Ruby </a></li><li class="post-tag" data-v-d832e844><a href="/tag/Arcgis" data-v-d832e844> Arcgis </a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><p>I've been working for a Land Surveying company as both a field chief and a project manager for almost a decade now.  After deciding to pursue a career in web development, I've been trying to think of ways to use my newly found knowledge to benefit the Land Surveying Community.  I've noticed that the <a href="http://ngs.noaa.gov" target="_blank" rel="noopener noreferrer">NGS website<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is outdated and not easily accessible on mobile devices so I decided to put together a quick web page to make the search for survey control that much easier.</p> <h2 id="demo"><a href="#demo" class="header-anchor">#</a> Demo</h2> <p>A demo for the application can be found at <a href="http://ngs-survey-control.herokuapp.com" target="_blank" rel="noopener noreferrer">ngs-survey-control.herokuapp.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.  All you need to know is the particular coordinates of a site you are working on and you can search for results within ten miles of the site.</p> <h2 id="behind-the-scenes"><a href="#behind-the-scenes" class="header-anchor">#</a> Behind the Scenes</h2> <p>The application is built on the Ruby programming language but could be easily applied to other languages.  The following ruby class is used to make the request to the API and it only depends on the <a href="https://github.com/lostisland/faraday" target="_blank" rel="noopener noreferrer">Faraday gem<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.  There's quite a bit of math related to figuring out the latitudes and longitudes of the envelope of the query.  Essentialy the <code>envelope_distance</code> method creates a 10 by 10 mile square (or close to it) with the center being the requested coordinates. The <code>distance_to</code> method will calculate the distance between a particular result and the initialized location.  The <code>results_within_mile</code> method narrows the results down to a radial search based on the entered distance.</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">NgsQuery</span>
  attr_accessor <span class="token symbol">:latitude</span><span class="token punctuation">,</span> <span class="token symbol">:longitude</span><span class="token punctuation">,</span> <span class="token symbol">:response</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">initialize</span></span><span class="token punctuation">(</span>latitude<span class="token punctuation">,</span> longitude<span class="token punctuation">)</span>
    <span class="token variable">@latitude</span> <span class="token operator">=</span> latitude
    <span class="token variable">@longitude</span> <span class="token operator">=</span> longitude
    send_request
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">results_within_mile</span></span><span class="token punctuation">(</span>distance<span class="token punctuation">)</span>
    <span class="token constant">JSON</span><span class="token punctuation">.</span>parse<span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'features'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>select <span class="token punctuation">{</span> <span class="token operator">|</span>feature<span class="token operator">|</span> distance_to<span class="token punctuation">(</span>feature<span class="token punctuation">[</span><span class="token string">'geometry'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> distance<span class="token punctuation">.</span>to_f <span class="token punctuation">}</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">distance_to</span></span><span class="token punctuation">(</span>location<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment"># Haversine Formula</span>
    φ<span class="token number">1</span> <span class="token operator">=</span> latitude<span class="token punctuation">.</span>to_f <span class="token operator">*</span> <span class="token constant">Math</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span>
    φ<span class="token number">2</span> <span class="token operator">=</span> location<span class="token punctuation">[</span><span class="token string">'y'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to_f <span class="token operator">*</span> <span class="token constant">Math</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span>
    long1 <span class="token operator">=</span> longitude<span class="token punctuation">.</span>to_f <span class="token operator">*</span> <span class="token constant">Math</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span>
    long2 <span class="token operator">=</span> location<span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to_f <span class="token operator">*</span> <span class="token constant">Math</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span>

    earth_radius <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">6371000</span> <span class="token operator">*</span> <span class="token number">0.000621371</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_f <span class="token comment"># miles</span>
    Δφ <span class="token operator">=</span> <span class="token punctuation">(</span>φ<span class="token number">2</span><span class="token operator">-</span>φ<span class="token number">1</span><span class="token punctuation">)</span>
    Δλ <span class="token operator">=</span> <span class="token punctuation">(</span>long2<span class="token operator">-</span>long1<span class="token punctuation">)</span>

    a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token constant">Math</span><span class="token punctuation">.</span>sin<span class="token punctuation">(</span>Δφ<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token constant">Math</span><span class="token punctuation">.</span>sin<span class="token punctuation">(</span>Δφ<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token constant">Math</span><span class="token punctuation">.</span>cos<span class="token punctuation">(</span>φ<span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token constant">Math</span><span class="token punctuation">.</span>cos<span class="token punctuation">(</span>φ<span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token constant">Math</span><span class="token punctuation">.</span>sin<span class="token punctuation">(</span>Δλ<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token constant">Math</span><span class="token punctuation">.</span>sin<span class="token punctuation">(</span>Δλ<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    c <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token constant">Math</span><span class="token punctuation">.</span>atan2<span class="token punctuation">(</span><span class="token constant">Math</span><span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">Math</span><span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token punctuation">(</span>earth_radius <span class="token operator">*</span> c<span class="token punctuation">.</span>to_f<span class="token punctuation">)</span><span class="token punctuation">.</span>round<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">send_request</span></span>
    <span class="token variable">@response</span> <span class="token operator">=</span> conn<span class="token punctuation">.</span>get <span class="token string">&quot;/ArcGIS/rest/services/NGS_Survey_Control_Points/MapServer/1/query&quot;</span><span class="token punctuation">,</span> request_params
  <span class="token keyword">end</span>

  <span class="token keyword">private</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">conn</span></span>
    <span class="token constant">Faraday</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token symbol">:url</span> <span class="token operator">=</span><span class="token operator">&gt;</span> query_url<span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>faraday<span class="token operator">|</span>
      faraday<span class="token punctuation">.</span>request  <span class="token symbol">:url_encoded</span>             <span class="token comment"># form-encode POST params</span>
      faraday<span class="token punctuation">.</span>adapter  <span class="token constant">Faraday</span><span class="token punctuation">.</span>default_adapter  <span class="token comment"># make requests with Net::HTTP</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">request_params</span></span>
    <span class="token punctuation">{</span>
      f<span class="token punctuation">:</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
      outSR<span class="token punctuation">:</span> <span class="token string">&quot;4326&quot;</span><span class="token punctuation">,</span>
      geometryType<span class="token punctuation">:</span> <span class="token string">'esriGeometryEnvelope'</span><span class="token punctuation">,</span>
      geometry<span class="token punctuation">:</span> envelope_distance<span class="token punctuation">,</span>
      inSR<span class="token punctuation">:</span> <span class="token string">&quot;4326&quot;</span><span class="token punctuation">,</span>
      outFields<span class="token punctuation">:</span> <span class="token string">&quot;DATA_SRCE,NAME,LAST_COND,ELEV_ORDER,STABILITY&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">query_url</span></span>
    <span class="token string">&quot;http://maps1.arcgisonline.com&quot;</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">envelope_distance</span></span>
    lat <span class="token operator">=</span> latitude<span class="token punctuation">.</span>to_f <span class="token operator">*</span> <span class="token constant">Math</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span>

    m1 <span class="token operator">=</span> <span class="token number">111132.92</span>
    m2 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">559.82</span>
    m3 <span class="token operator">=</span> <span class="token number">1.175</span>
    m4 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.0023</span>
    p1 <span class="token operator">=</span> <span class="token number">111412.84</span>
    p2 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">93.5</span>
    p3 <span class="token operator">=</span> <span class="token number">0.118</span>

    latlen <span class="token operator">=</span> m1 <span class="token operator">+</span> <span class="token punctuation">(</span>m2 <span class="token operator">*</span> <span class="token constant">Math</span><span class="token punctuation">.</span>cos<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> lat<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>m3 <span class="token operator">*</span> <span class="token constant">Math</span><span class="token punctuation">.</span>cos<span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">*</span> lat<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>m4 <span class="token operator">*</span> <span class="token constant">Math</span><span class="token punctuation">.</span>cos<span class="token punctuation">(</span><span class="token number">6</span> <span class="token operator">*</span> lat<span class="token punctuation">)</span><span class="token punctuation">)</span>
    longlen <span class="token operator">=</span> <span class="token punctuation">(</span>p1 <span class="token operator">*</span> <span class="token constant">Math</span><span class="token punctuation">.</span>cos<span class="token punctuation">(</span>lat<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>p2 <span class="token operator">*</span> <span class="token constant">Math</span><span class="token punctuation">.</span>cos<span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> lat<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>p3 <span class="token operator">*</span> <span class="token constant">Math</span><span class="token punctuation">.</span>cos<span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> lat<span class="token punctuation">)</span><span class="token punctuation">)</span>

    latfeet <span class="token operator">=</span> latlen <span class="token operator">*</span> <span class="token number">3.280833333</span>
    latsm <span class="token operator">=</span> latfeet <span class="token operator">/</span> <span class="token number">5280</span>
    latenv <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> latsm

    longfeet <span class="token operator">=</span> longlen <span class="token operator">*</span> <span class="token number">3.280833333</span>
    longsm <span class="token operator">=</span> longfeet <span class="token operator">/</span> <span class="token number">5280</span>
    longenv <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> longsm
    <span class="token string">&quot;{xmin: <span class="token interpolation"><span class="token delimiter tag">#{</span>longitude<span class="token punctuation">.</span>to_f <span class="token operator">-</span> longenv<span class="token delimiter tag">}</span></span>, ymin: <span class="token interpolation"><span class="token delimiter tag">#{</span>latitude<span class="token punctuation">.</span>to_f <span class="token operator">-</span> latenv<span class="token delimiter tag">}</span></span>, xmax: <span class="token interpolation"><span class="token delimiter tag">#{</span>longitude<span class="token punctuation">.</span>to_f <span class="token operator">+</span> longenv<span class="token delimiter tag">}</span></span>, ymax: <span class="token interpolation"><span class="token delimiter tag">#{</span>latitude<span class="token punctuation">.</span>to_f <span class="token operator">+</span> latenv<span class="token delimiter tag">}</span></span>}&quot;</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre></div><h2 id="retrieving-results"><a href="#retrieving-results" class="header-anchor">#</a> Retrieving Results</h2> <p>You can initialize and output results like so:</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token variable">@query</span> <span class="token operator">=</span> <span class="token constant">NgsQuery</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token string">'40'</span><span class="token punctuation">,</span><span class="token string">'-105'</span><span class="token punctuation">)</span>
<span class="token variable">@results</span> <span class="token operator">=</span> query<span class="token punctuation">.</span>results_within_mile<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment"># =&gt;</span>
<span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token string">&quot;attributes&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;DATA_SRCE&quot;</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;http://www.ngs.noaa.gov/cgi-bin/ds_mark.prl?PidBox=AB3292&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;NAME&quot;</span>        <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;BASELINE&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;LAST_COND&quot;</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;GOOD&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;ELEV_ORDER&quot;</span>  <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;STABILITY&quot;</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;A&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;geometry&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token string">&quot;x&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">104.97833635353035</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">39.99991861318452</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token string">&quot;attributes&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;DATA_SRCE&quot;</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;http://www.ngs.noaa.gov/cgi-bin/ds_mark.prl?PidBox=AI3578&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;NAME&quot;</span>        <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;LUCY&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;LAST_COND&quot;</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;GOOD&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;ELEV_ORDER&quot;</span>  <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;STABILITY&quot;</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;C&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;geometry&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token string">&quot;x&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">105.01147022230495</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">40.00009957099936</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token string">&quot;attributes&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;DATA_SRCE&quot;</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;http://www.ngs.noaa.gov/cgi-bin/ds_mark.prl?PidBox=KK2064&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;NAME&quot;</span>        <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;SLATER&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;LAST_COND&quot;</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;GOOD&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;ELEV_ORDER&quot;</span>  <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;STABILITY&quot;</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;C&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;geometry&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token string">&quot;x&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">104.9939545780444</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">39.99348464681532</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="creating-the-views"><a href="#creating-the-views" class="header-anchor">#</a> Creating the Views</h2> <p>Here's a simple html table built using erb syntax where <code>@results</code> is an array of results similar to what's shown above and <code>@query</code> is the initialized NgsQuery class.  The application that I'm using is built on the Ruby on Rails framework which uses the <code>link_to</code> method to generate the link for the datasheet.</p> <div class="language-erb extra-class"><pre class="language-erb"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Elevation Order<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Stability<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Condition<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Link<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Distance from coordinates<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">&gt;</span></span>
    <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token variable">@results</span><span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>result<span class="token operator">|</span> <span class="token delimiter punctuation">%&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> result<span class="token punctuation">[</span><span class="token string">'attributes'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'NAME'</span><span class="token punctuation">]</span> <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> result<span class="token punctuation">[</span><span class="token string">'attributes'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'ELEV_ORDER'</span><span class="token punctuation">]</span> <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> result<span class="token punctuation">[</span><span class="token string">'attributes'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'STABILITY'</span><span class="token punctuation">]</span> <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> result<span class="token punctuation">[</span><span class="token string">'attributes'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'LAST_COND'</span><span class="token punctuation">]</span> <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> link_to result<span class="token punctuation">[</span><span class="token string">'attributes'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'DATA_SRCE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> result<span class="token punctuation">[</span><span class="token string">'attributes'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'DATA_SRCE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> target<span class="token punctuation">:</span> <span class="token string">&quot;_blank&quot;</span> <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> <span class="token variable">@query</span><span class="token punctuation">.</span>distance_to<span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'geometry'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
    <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span> <span class="token keyword">end</span> <span class="token delimiter punctuation">%&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="sample-of-results-that-can-be-ouput-to-a-table"><a href="#sample-of-results-that-can-be-ouput-to-a-table" class="header-anchor">#</a> Sample of Results that can be ouput to a table</h2> <table><thead><tr><th>Name</th> <th>Elevation Order</th> <th>Stability</th> <th>Condition</th> <th>Link</th> <th>Distance from Coordinates</th></tr></thead> <tbody><tr><td>AS P 313</td> <td></td> <td>C</td> <td>MONUMENTED</td> <td>http://www.ngs.noaa.gov/cgi-bin/ds_mark.prl?PidBox=KK1950</td> <td>1.77</td></tr> <tr><td>BALD MTN</td> <td></td> <td></td> <td>GOOD</td> <td>http://www.ngs.noaa.gov/cgi-bin/ds_mark.prl?PidBox=KK1949</td> <td>1.77</td></tr> <tr><td>C 175</td> <td>2</td> <td>C</td> <td>MARK NOT FOUND</td> <td>http://www.ngs.noaa.gov/cgi-bin/ds_mark.prl?PidBox=JK0449</td> <td>2.85</td></tr></tbody></table> <p>The most useful part of displaying the results to a table is that it returns the condition of the monument.  You can see that point C 175 says &quot;MARK NOT FOUND&quot;.  Normally a surveyor won't notice this until they are out in the field with the datasheet and it's too late at that point.  You can easily skip over that point without even looking at the datasheet.</p> <br>
I hope you enjoyed this post and you can see the full source of the project at [https://github.com/rlafranchi/ngs-survey-control](https://github.com/rlafranchi/ngs-survey-control)
<h2 id="resources"><a href="#resources" class="header-anchor">#</a> Resources</h2> <ul><li>Calculate distance, bearing and more between Latitude/Longitude points: <a href="http://www.movable-type.co.uk/scripts/latlong.html" target="_blank" rel="noopener noreferrer">http://www.movable-type.co.uk/scripts/latlong.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>Length Of A Degree Of Latitude
And Longitude Calculator: <a href="http://www.csgnetwork.com/degreelenllavcalc.html" target="_blank" rel="noopener noreferrer">http://www.csgnetwork.com/degreelenllavcalc.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#demo" title="Demo">Demo</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#behind-the-scenes" title="Behind the Scenes">Behind the Scenes</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#retrieving-results" title="Retrieving Results">Retrieving Results</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#creating-the-views" title="Creating the Views">Creating the Views</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#sample-of-results-that-can-be-ouput-to-a-table" title="Sample of Results that can be ouput to a table">Sample of Results that can be ouput to a table</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#resources" title="Resources">Resources</a></div></div></div></div> <form autocapitalize="off" autocomplete="off" class="console mini" data-v-342a5c4e><div class="entered-lines" data-v-342a5c4e></div> <div class="command-line" data-v-342a5c4e><label for="console" data-v-342a5c4e>&gt; </label> <input type="text" id="console" name="console" spellcheck="false" value="" data-v-342a5c4e> <span class="hint" style="padding-left:21px;" data-v-342a5c4e></span></div></form> <footer class="footer" data-v-cdcb074a><div class="footer-left-wrap" data-v-cdcb074a><ul class="contact" data-v-cdcb074a><li class="contact-item" data-v-cdcb074a><a href="https://github.com/rlafranchi" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-cdcb074a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-cdcb074a><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-cdcb074a></path></svg>
          
        </a></li><li class="contact-item" data-v-cdcb074a><a href="https://twitter.com/ralafranchi" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-cdcb074a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter" data-v-cdcb074a><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z" data-v-cdcb074a></path></svg>
          
        </a></li><li class="contact-item" data-v-cdcb074a><a href="mailto:rlafranchi@icloud.com" class="nav-link external" data-v-cdcb074a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail" data-v-cdcb074a><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" data-v-cdcb074a></path><polyline points="22,6 12,13 2,6" data-v-cdcb074a></polyline></svg>
          
        </a></li><li class="contact-item" data-v-cdcb074a><a href="https://www.linkedin.com/in/richard-lafranchi-95945988/" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-cdcb074a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-linkedin" data-v-cdcb074a><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z" data-v-cdcb074a></path><rect x="2" y="9" width="4" height="12" data-v-cdcb074a></rect><circle cx="4" cy="4" r="2" data-v-cdcb074a></circle></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-cdcb074a><ul class="copyright" data-v-cdcb074a><li class="copyright-item" data-v-cdcb074a>Copyright © 2015-present Richard LaFranchi</li></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.79e45c90.js" defer></script><script src="/assets/js/6.b90c3e6b.js" defer></script><script src="/assets/js/4.36743f4f.js" defer></script><script src="/assets/js/17.05c4363e.js" defer></script>
  </body>
</html>
